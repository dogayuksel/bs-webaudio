// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE

import * as Curry from "bs-platform/lib/es6/curry.js";
import * as React from "react";
import * as Pervasives from "bs-platform/lib/es6/pervasives.js";
import * as Belt_Option from "bs-platform/lib/es6/belt_Option.js";
import * as Caml_option from "bs-platform/lib/es6/caml_option.js";
import * as Knob$WebAudio from "./Knob.bs.js";
import * as Slider$WebAudio from "./Slider.bs.js";
import * as Switch$WebAudio from "./Switch.bs.js";
import * as Envelope$WebAudio from "../Envelope/Envelope.bs.js";
import * as Oscillator$WebAudio from "../Oscillator/Oscillator.bs.js";
import * as EnvelopeUnit$WebAudio from "./EnvelopeUnit.bs.js";
import * as AppContextProvider$WebAudio from "./AppContextProvider.bs.js";

function OscillatorUnit(Props) {
  var name = Props.name;
  var targetOutput = Props.targetOutput;
  var appContext = React.useContext(AppContextProvider$WebAudio.appContext);
  var match = React.useState((function () {
          return ;
        }));
  var setOscillator = match[1];
  var oscillator = match[0];
  var match$1 = React.useState((function () {
          return ;
        }));
  var setEnvelope = match$1[1];
  var envelope = match$1[0];
  React.useEffect((function () {
          var match = appContext.audioContext;
          if (match !== undefined) {
            var audioCtx = Caml_option.valFromOption(match);
            var target = targetOutput !== undefined ? Caml_option.valFromOption(targetOutput) : audioCtx.destination;
            var osc = Oscillator$WebAudio.connect(target, Oscillator$WebAudio.make(/* Sine */0, audioCtx));
            Curry._1(setOscillator, (function (param) {
                    return osc;
                  }));
            var envelope$1 = Envelope$WebAudio.make(Oscillator$WebAudio.getEnvelopeGain(osc), audioCtx);
            Curry._1(setEnvelope, (function (param) {
                    return envelope$1;
                  }));
          } else {
            console.log("Missing Audio Context");
          }
          return (function (param) {
                    Belt_Option.map(oscillator, Oscillator$WebAudio.disconnect);
                    Belt_Option.map(envelope, appContext.removeFromTriggerTargets);
                    return /* () */0;
                  });
        }), ([]));
  var tmp;
  if (oscillator !== undefined && envelope !== undefined) {
    var o = oscillator;
    tmp = React.createElement(React.Fragment, undefined, React.createElement(Knob$WebAudio.make, {
              name: "Frequency",
              config: {
                minValue: 1.0,
                maxValue: 18000.0,
                scale: /* Logarithmic */1,
                size: 120
              },
              initialParamValue: Oscillator$WebAudio.getFrequency(o).value,
              setParamValue: (function (frequency) {
                  return Oscillator$WebAudio.setFrequency(frequency, o);
                })
            }), React.createElement(Slider$WebAudio.make, {
              name: "Gain",
              param: Oscillator$WebAudio.getOscillatorGain(o),
              config: {
                minValue: Pervasives.epsilon_float,
                maxValue: 100.0
              }
            }), React.createElement(EnvelopeUnit$WebAudio.make, {
              envelope: envelope
            }));
  } else {
    tmp = null;
  }
  return React.createElement("div", undefined, React.createElement("h2", undefined, name), React.createElement(Switch$WebAudio.make, {
                  toggle: (function (param) {
                      var envelope$1 = envelope;
                      Belt_Option.map(oscillator, Oscillator$WebAudio.start);
                      Belt_Option.map(envelope$1, appContext.addToTriggerTargets);
                      return /* () */0;
                    }),
                  initialState: false,
                  children: "Start"
                }), tmp);
}

var make = OscillatorUnit;

export {
  make ,
  
}
/* react Not a pure module */
